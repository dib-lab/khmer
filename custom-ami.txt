=====================
Creating a Custom AMI
=====================

When you find yourself continually starting EC2 instances and instantly having
to modify the AMI before each project, you may consider creating a custom AMI.
Below are the steps used to create ami-81bb87e8.

Launch base image
-----------------

The ubuntu to provides at excellent base for our needs. As such we will begin with ami-967edcff (see :doc:`start-up-an-ec2-instance`).

Once you have logged into your machine via the command line, we can start to add custom packages.

Customizing the instance
------------------------
Since our basic animation is a long-term release of Ubuntu, first we need to sure everything is up to date::
		sudo –i
		apt–get –y update
		apt–get –y dist–upgrade

next we need to make sure we have installed all packages commonly used in our programs::
		apt-get -y install mercurial less python-matplotlib unzip bzip2 zlib1g-dev ncurses-dev python-dev g++ screen pkg-config python-pip curl git

Enabling root access
--------------------
Since most of our scripts require root access, it is a good idea to permanently enable  this feature::
		sudo perl -i -pe 's/disable_root: 1/disable_root: 0/' /etc/cloud/cloud.cfg
		sudo perl -i -pe 's/#PermitRootLogin .*/PermitRootLogin without-password/' /etc/ssh/sshd_config
		sudo perl -i -pe 's/.*(ssh-rsa .*)/\1/' /root/.ssh/authorized_keys
		sudo /etc/init.d/sshd reload # optional command

Next we want to make sure the image boots correctly. To do this simply type
"reboot". By doing this your machine will be assigned a new ID, go to your
Amazon EC2 console management page to find the server's new name. Once you have
this long into the machine just to make sure it works properly.

Saving the new AMI
------------------
 Now we know that the images working we can create a new AMI.  in the next steps
 we will use the Amazon EC to console management page.

 On the navigation pane click on Instances and this will take you to a list of
 all your running machines. Right-click on the image  you would like to make an
 AMI.  From the drop-down menu choose "Create Image".

 .. image:: images/ec2-create-img1.png
   :width: 50 
 
 This will open a pop-up window, where we will need to fill in the image name
 and description.

 .. image:: images/ec2-create-img2.png
   :width: 50 

Now press "create image". 

Generally it will take around five minutes for Amazon to process this request.
When the new AMI  has been created, you will be able to find it by using your
navigation pane in selecting AMIs.

For more information visit `documentation on Amazon 
<http://docs.aws.amazon.com/gettingstarted/latest/wah-linux/getting-started-create-custom-ami.html>`_.
